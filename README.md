# Subscription Management System (Case Two)

Полноценная подписочная модель с поддержкой платежей, автоматического списания средств и управления жизненным циклом подписок.

## Основные возможности

* **Подписочная модель и платежи:** управление длительностью и стоимостью подписок; имитация платежного шлюза через FakePaymentGateway с обработкой задержек и случайных ошибок API (edge case: недоступность системы); логирование всех пополнений и списаний с баланса.
* **Управление жизненным циклом:** 
Реализован конечный автомат состояний подписки:
Active — подписка оплачена и доступна.
Pending Renewal — (Edge Case) наступил срок продления, но на балансе недостаточно средств. Система ожидает пополнения.
Expired — срок действия истек.
Canceled — пользователь отменил автопродление.
* **Автоматизация и фоновые задачи:** использование django-background-tasks для ежедневной проверки подписок; При пополнении баланса система автоматически проверяет наличие подписок в статусе pending_renewal и мгновенно активирует их (UX edge case).
* **Система уведомлений:** интерактивная панель уведомлений в реальном времени; классификация уведомлений: успешная оплата, ошибка списания, уведомление об истечении; функционал «Прочитать все» и «Отметить как прочитанное» через REST API.


## Технологический стек
Backend: Python 3.x, Django, Django REST Framework (DRF).
Frontend: Streamlit.
Database: SQLite.
Tasks: Django Background Tasks.
Auth: JWT (JSON Web Tokens).


## Обработка Edge Cases
1. Race Conditions: Использование db_transaction.atomic() и блокировок select_for_update() при работе с балансом пользователя для исключения двойных списаний.
2. Недостаток средств: Вместо удаления подписки система переводит ее в режим ожидания и уведомляет пользователя.
3. Ошибки шлюза: Реализована логика повторных попыток при временной недоступности платежной системы.

## Установка и запуск
1. Клонируйте репозиторий:
`git clone <url_репозитория>`

2. Установите зависимости:
`pip install -r requirements.txt`

3. Запустите миграции
`python manage.py migrate`

4. Запустите воркер фоновых задач (в отдельном терминале):
`python manage.py process_tasks`
`python manage.py process_tasks --log-std`

5. Запустите сервер и фронтенд (в разных терминалах):
`python manage.py runserver`
`streamlit run frontend/app.py`
